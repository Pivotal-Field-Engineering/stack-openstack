---
# Knife plugins for VM creation and bootstrapping

vagrant_ubuntu_1404:

  create_2nic_768M:
    plugin: vagrant
    options:
      vagrant_dir: ~/.vagrant
      provider: "#{my['vagrant']['provider']}"
      box: "#{my['vagrant']['box_name']}"
      box_url: "#{my['vagrant']['box_url']}"
      memsize: 768
      subnet: "#{env['vagrant']['management_network']}/25"
      port_forward: {}
      share_folders: []
      use_cachier: false
      distro: chef-full
      host_key_verify: false
      identity_file: ~/.vagrant/insecure_key
      ssh_user: vagrant
      ssh_port: 22
      sudo: true
      inline_config: |
        config.vm.network "private_network", :auto_config => false, ip: "#{env['vagrant']['management_network']}"
        config.ohai.enable = true
        config.ohai.primary_nic = "eth1"
        config.vm.provision "shell", inline: "mkdir -p /etc/chef"
        config.vm.provision "shell", inline: "apt-get update"
      run_list:
      - recipe[ohai]

  create_1nic_4G:
    plugin: vagrant
    options:
      vagrant_dir: ~/.vagrant
      provider: "#{my['vagrant']['provider']}"
      box: "#{my['vagrant']['box_name']}"
      box_url: "#{my['vagrant']['box_url']}"
      memsize: 4096
      subnet: "#{env['vagrant']['management_network']}/25"
      # The '+' at the end of the IP indicates that the last octet
      # is incremented by the created node instance's index value.
      ip_address: "#{env['proxy']['backend_default_ip']}+"
      port_forward: {}
      share_folders: []
      use_cachier: false
      distro: chef-full
      host_key_verify: false
      identity_file: ~/.vagrant/insecure_key
      ssh_user: vagrant
      ssh_port: 22
      sudo: true
      # VBox: Create additional hard disk for Cinder volumes
      vb_customize: >
        'createhd', '--filename', './cinder_volume.vdi', '--size', 20 * 1024::
        "storagectl", :id, "--name", "SATA Controller", "--add", "sata"::
        'storageattach', :id, '--storagectl', "SATA Controller", '--port', 1, '--device', 0, '--type', 'hdd', '--medium', './cinder_volume.vdi'
      # VMWare: Create additional hard disk for Cinder volumes
      vmx_parameters: >
        numvcpus=2::
        vhv.enable=TRUE::
        scsi0:1.present=TRUE::
        scsi0:1.fileName=cinder_volume.vmdk::
        scsi0:1.fileSize=20GB
      inline_config: |
        config.ohai.enable = true
        config.ohai.primary_nic = "eth1"
        config.vm.provision "shell", inline: "mkdir -p /etc/chef"
        config.vm.provision "shell", inline: "apt-get update"
      run_list:
      - recipe[ohai]

  create_2nic_2G:
    plugin: vagrant
    options:
      vagrant_dir: ~/.vagrant
      provider: "#{my['vagrant']['provider']}"
      box: "#{my['vagrant']['box_name']}"
      box_url: "#{my['vagrant']['box_url']}"
      memsize: 2048
      subnet: "#{env['vagrant']['management_network']}/25"
      port_forward: {}
      share_folders: []
      use_cachier: false
      distro: chef-full
      host_key_verify: false
      identity_file: ~/.vagrant/insecure_key
      ssh_user: vagrant
      ssh_port: 22
      sudo: true
      # VBox: enable promiscuous mode on nic on data network
      vb_customize: >
        'modifyvm', :id, "--nicpromisc3", "allow-all"
      vmx_parameters: >
        numvcpus=2::
        vhv.enable=TRUE
      inline_config: |
        config.vm.network "private_network", :auto_config => false, ip: "#{env['vagrant']['data_network']}"
        config.ohai.enable = true
        config.ohai.primary_nic = "eth1"
        config.vm.provision "shell", inline: "mkdir -p /etc/chef"
        config.vm.provision "shell", inline: "apt-get update"
      run_list:
      - recipe[ohai]
